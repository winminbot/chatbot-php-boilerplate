<?php

 $input = json_decode(file_get_contents('php://input'), true);
$sender = $input['entry'][0]['messaging'][0]['sender']['id'];
$message = $input['entry'][0]['messaging'][0]['message']['text'];

$pagetoken = "***********"; // Facebook TOKEN

// Proovl API https://www.proovl.com/sms-api
$user = "fasfasfasf"; //Proovl UserID
$token = "***************"; //Proovl Token
$from = "************"; //Proovl Number

$obj = json_decode($input);
$result = explode(';',$message);



if ($message == "instruction") {

 $message_to_reply = "Message format: Number;Text";

}

else {
// exmaple User ID: 545456188323111233
$white = array("**************");

if (in_array("$sender", $white)) {

// send sms
if (is_numeric($result[0]))  
{  

    
	$url = "https://www.proovl.com/api/send.php";

	$postfields = array(
		'user' => "$user",
		'token' => "$token",
		'from' => "$from",
		'to' => "$result[0]",
		'text' => "$result[1]"
	);

	if (!$curld = curl_init()) {
		exit;
	}

	curl_setopt($curld, CURLOPT_POST, true);
	curl_setopt($curld, CURLOPT_POSTFIELDS, $postfields);
	curl_setopt($curld, CURLOPT_URL,$url);
	curl_setopt($curld, CURLOPT_RETURNTRANSFER, true);

	$output = curl_exec($curld);

	curl_close ($curld);
	
	$status = explode(';',$output);
	
	 $message_to_reply = "[$result[0]|$result[1]]     Message ID: $status[1]; Status: $status[0]";
	
}  

   else { $message_to_reply = "Wrong Format!ðŸ¦Š Type:instruction"; }
    
}

else {  $message_to_reply = "Access denied ðŸ˜• Contact Admin ðŸ“ž"; }

}

if(preg_match('[time|current time|now]', strtolower($message))) {
// avoid a lot of requests

 if($input != '') {
 
 $message_to_reply = $result;

 }

} else {

$list=array(
"hi"=> "Hi, á€™á€‚á¤á€œá€¬á€•á€«"
"what is your name" => "á€€á€ºá€¼á€”á€¹á€±á€á€¬á€¹á€·á€”á€¬á€™á€Šá€¹á€€ á€±á€™á€¬á€„á€¹á€…á€¬á€›á€„á€¹á€¸á€€á€­á€¯á€„á€¹á€•á€«"


);
$obj= $list["$message"];


$url = "https://graph.facebook.com/v2.6/me/messages?access_token=$pagetoken";
//Initiate cURL.
$ch = curl_init($url);
//The JSON data.

$jsonData = '{
 "recipient":{
 "id":"'.$sender.'"
 }, 
  "message":{
     "text":"'.$message_to_reply.'"
  }
}';

//Encode the array into JSON.
$jsonDataEncoded = $jsonData;
//Tell cURL that we want to send a POST request.
curl_setopt($ch, CURLOPT_POST, 1);
//Attach our encoded JSON string to the POST fields.
curl_setopt($ch, CURLOPT_POSTFIELDS, $jsonDataEncoded);
//Set the content type to application/json
curl_setopt($ch, CURLOPT_HTTPHEADER, array('Content-Type: application/json'));
//curl_setopt($ch, CURLOPT_HTTPHEADER, array(â€˜Content-Type: application/x-www-form-urlencodedâ€™));
//Execute the request

if(!empty($input['entry'][0]['messaging'][0]['message'])){
 $result = curl_exec($ch);
}
 
}

  
/* Verification Facebook webhook    
$access_token = "EAAHHJNIPckoBACuyagRdb8bRwJGsf3tfCjdDIRxnuUqzJCNqN2yZAd3wqiM9NldUBiOpqoxJJUq9ZBeUmO1ZBfbvnZBZC4e3y35eDquUfp2xQDaBUqRvrJP6jjvSzZBLcugaUQq7iC1nyRq3HPAvK2LdRJ7RUh0t5dtSoIQfYScQZDZD"; // Facebook token
$verify_token = "my-token";
$hub_verify_token = null;
if(isset($_REQUEST['hub_challenge'])) {
 $challenge = $_REQUEST['hub_challenge'];
 $hub_verify_token = $_REQUEST['hub_verify_token'];
}
if ($hub_verify_token === $verify_token) {
 echo $challenge;
}
*/

?>
